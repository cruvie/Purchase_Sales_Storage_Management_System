<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.cmk.mapper.SaleMapper">
    <resultMap id="saleResultMap" type="_AssemblePSU">

        <association property="sale" javaType="_Sale" column="userId"
                     select="getSale">
        </association>

        <association property="user" javaType="_User" column="userId"
                     select="getUser">
        </association>

        <association property="product" javaType="_Product" column="productId"
                     select="getProduct">
        </association>
    </resultMap>

    <select id="getSale" resultType="_Sale">
        select*
        from sale
        where id = #{id}
    </select>

    <select id="getUser" resultType="_User">
        select *
        from user
        where id = #{userId};
    </select>

    <select id="getProduct" resultType="_Product">
        select *
        from product
        where id = #{productId};
    </select>

    <select id="getAssembled" resultMap="saleResultMap">
        select *
        from sale,
             user,
             product
        where sale.userId = user.id
          and sale.productId = product.id
    </select>

    <select id="getAssembledOneById" resultMap="saleResultMap">
        select *
        from sale,
             user,
             product
        where sale.id = #{id}
          and sale.userId = user.id
          and sale.productId = product.id
    </select>

    <select id="getAssembledOneByName" resultMap="saleResultMap">
        select *
        from sale,
             user,
             product
        where user.realName = #{name}
          and sale.userId = user.id
          and sale.productId = product.id
    </select>

</mapper>
